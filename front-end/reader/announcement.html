<!doctype html>
<html class="no-js" lang="zxx">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>News</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Google font (font-family: 'Roboto', sans-serif; Poppins ; Satisfy) -->
	<!--
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet"> 
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,500,600,600i,700,700i,800" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
	-->


	<!-- Stylesheets -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/plugins.css">
	<link rel="stylesheet" href="style.css">

	<!-- Cusom css -->
   <link rel="stylesheet" href="css/custom.css">

	<!-- Modernizer js -->
	<script src="js/vendor/modernizr-3.5.0.min.js"></script>
</head>
<body>
	<!--[if lte IE 9]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
	<![endif]-->

	<!-- Main wrapper -->
	<div class="wrapper" id="wrapper">
		
		<!-- Header -->
		<header id="wn__header" class="oth-page header__area header__absolute sticky__header">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-6 col-sm-6 col-6 col-lg-2">
						<div class="logo-area">
							<a href="index.html">
								<img src="images/logo/logo黑字.png" alt="logo images">
							</a>
						</div>
					</div>
					<div class="col-lg-8 d-none d-lg-block">
					<nav class="mainmenu__nav">
						</nav>						
					</div>
					<div class="col-md-6 col-sm-6 col-6 col-lg-2">
						<ul class="header__sidebar__right d-flex justify-content-end align-items-center">							
							<li class="setting__bar__icon"><a class="setting__active" href="#"></a>
								<div class="searchbar__content setting__block">
									<div class="content-inner">
										<div class="switcher-currency">
											<strong class="label switcher-label">
												<span>Language</span>
											</strong>
											<div class="switcher-options">
												<div class="switcher-currency-trigger">
													<span class="currency-trigger">English</span>
													<ul class="switcher-dropdown">
														<li>中文</li>														
													</ul>
												</div>
											</div>
										</div>
										<div class="switcher-currency">
											<strong class="label switcher-label">
												<span id="topMenu">My Account</span>
											</strong>
											<div class="switcher-options">
												<div class="switcher-currency-trigger">
													<div class="setting__menu">
														<span><a id="accMenu" onclick="personConsole()">My Account</a></span>
														<span><a id="accLog" onclick="signinServer()">Log In</a></span>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</li>
						</ul>
					</div>
				</div>
				<!-- Start Mobile Menu -->				
			</div>		
		</header>
		<!-- //Header -->
        <!-- Start Bradcaump area -->
        <div class="ht__bradcaump__area bg-image--8">
            <div class="container">
                <div class="contentbox">
		            <h1>Recent News </h1>
		        </div>
            </div>
        </div>
        <!-- End Bradcaump area -->
        <!-- Start Shop Page -->
        <div class="page-shop-sidebar left--sidebar bg--white section-padding--lg">
        	<div class="container">
        		<div class="row">
        			<div class="col-lg-12 col-12 order-1 order-lg-2">
        				
        				<div class="tab__container">
	        		
	        				<div class="shop-grid tab-pane fade show active" id="nav-list" role="tabpanel">
	        					<div id="listView" class="list__view__wrapper">
	        						<!-- Start Single Anc -->
	        						<div class="list__view">
	        							<div class="col-lg-12">
	        							    <div class="content">
	        								     <h2 class="title">Just a moment</h2>
	        								     <h4 class="date">...</h4>
	        								
	        								     <p class="c">	...</p>
	        								     <ul class="cart__action d-flex">
	        									    <li class="cart"><a href="single-announcement.html">learn more</a></li>
	        								     </ul>
                                             </div>
	        							 </div>
	        						</div>
	        						<div class="list__view">
	        							<div class="col-lg-12">
	        							    <div class="content">
	        								     <h2 class="title">Just a moment</h2>
	        								     <h4 class="date">...</h4>
	        								
	        								     <p class="c">	...</p>
	        								     <ul class="cart__action d-flex">
	        									    <li class="cart"><a href="single-announcement.html">learn more</a></li>
	        								     </ul>
                                             </div>
	        							 </div>
	        						</div>
	        						<div class="list__view">
	        							<div class="col-lg-12">
	        							    <div class="content">
	        								     <h2 class="title">Just a moment</h2>
	        								     <h4 class="date">...</h4>
	        								
	        								     <p class="c">	...</p>
	        								     <ul class="cart__action d-flex">
	        									    <li class="cart"><a href="single-announcement.html">learn more</a></li>
	        								     </ul>
                                             </div>
	        							 </div>
	        						</div>
	        						<div class="list__view">
	        							<div class="col-lg-12">
	        							    <div class="content">
	        								     <h2 class="title">Just a moment</h2>
	        								     <h4 class="date">...</h4>
	        								
	        								     <p class="c">	...</p>
	        								     <ul class="cart__action d-flex">
	        									    <li class="cart"><a href="single-announcement.html">learn more</a></li>
	        								     </ul>
                                             </div>
	        							 </div>
	        						</div>
	        						<!-- End Single Anc -->
	        					</div>
	        					<ul id="pageBar" class="wn__pagination">
	        						<li class="active"><a href="#">1</a></li>
	        						<li><a href="#">2</a></li>
	        						<li><a href="#">3</a></li>
	        						<li><a href="#">4</a></li>
	        						<li><a href="#"><i class="zmdi zmdi-chevron-right"></i></a></li>
	        					</ul>
	        				</div>
        				</div>
        			</div>
        		</div>
        	</div>
        </div>
        <!-- End Shop Page -->
		<!-- Footer Area -->
		<footer id="wn__footer" class="footer__area bg__cat--8 brown--color">
			<div class="footer-static-top">
				<div class="container">
					<div class="row">
						<div class="col-lg-12">
							<div class="footer__widget footer__menu">
								<div class="ft__logo">
									<a href="index.html">
										<img src="images/logo/logo黑字.png" width="150" height="50" alt="logo">
									</a>
									<p style="color: rgb(117, 117, 117)">Ideal books is the key to wisdom.    —— Lev Tolstoy</p>
								</div>
								<!-- <div class="footer__content">
									<ul class="mainmenu d-flex justify-content-center">
										<li><a href="booklist.html">All Product</a></li>
										<li><a href="https://weibo.com">Blog</a></li>
										<li><a href="#">Contact</a></li>
										<li><a href="#"><img src="images/contact/wechat.png" width="35" height="35" ></a></li>
										<li><a href="#"><img src="images/contact/qq.png" width="35" height="35" ></a></li><
									</ul>
								</div> -->
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="copyright__wrapper">
				<div class="container">
					<div class="row">
						<div class="col-lg-12 col-md-6 col-sm-12">
							<div class="copyright"> 
								<div class="copy__right__inner text-center" >
									<p>©2018 XDU-SPM-B2 Copyright</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!-- //Footer Area -->

		</div>
		<!-- //Main wrapper -->

		<!-- JS Files -->
		<script src="js/vendor/jquery-3.2.1.min.js"></script>
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/plugins.js"></script>
		<script src="js/active.js"></script>
		
		<script src="../socket.io.js"></script>
		<script src="../cookie.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script src="../ipconfig.js"></script>

		<script type="text/javascript">

			var href = location.href;
			var auth_data = {};


			auth_data.username = Cookies.get("username");
			auth_data.session = Cookies.get("session");
			auth_data.type = Cookies.get("type");
			auth_data.cur = "reader";
			var accMenu = document.getElementById('accMenu');
			var accLog = document.getElementById('accLog');
			var topMenu = document.getElementById('topMenu');

			var listView = document.getElementById('listView');
			var pageBar = document.getElementById('pageBar');

			var page_scale = 4;
			var annList = null;
			var logFlag = false;
			var pageNum = 0;
			var lastPageBookNum = 0;

			var socket = io(ip);

			function showPage(page_index) {

				var now_index = Cookies.get('now_index');
				if (now_index == page_index)
					return;
				Cookies.set('now_index', page_index);
				for (var i = 0; i < pageBar.childNodes.length; i++) {
					if (pageBar.childNodes[i].hasAttribute('class'))
						pageBar.childNodes[i].removeAttribute('class');
				}

				pageBar.childNodes[page_index].setAttribute('class', 'active');
				var temp_len = listView.childNodes.length;
				for (var i = 0; i < temp_len; i++) {
					listView.removeChild(listView.childNodes[0]);
				}
				//window.alert(temp_len);
				var begin_index = page_index * page_scale;
				var end_index = begin_index + page_scale;//最后一本书index的下一个值
				if (end_index > annList.length)
					end_index = annList.length;
				for (var i = begin_index; i < end_index; i++) {
					var item = annList[i];

					var divFrame = document.createElement('div');
					divFrame.setAttribute('class', 'list__view');

					var div_col = document.createElement('div');
					div_col.setAttribute('class', 'col-lg-12');

					var div_con = document.createElement('div');
					div_con.setAttribute('class', 'content');
					div_con.setAttribute('style', 'padding-top: 40px');

					var h1 = document.createElement('h2');
					h1.setAttribute('class', 'title');
					h1.innerHTML = item.title;

					var h2 = document.createElement('h5');
					h2.setAttribute('class', 'date');
					h2.setAttribute('style', 'color: rgb(117, 117, 117)');
					h2.innerHTML = item.date;

					var p = document.createElement('p');
					p.setAttribute('class', 'c');
					p.setAttribute('style', 'font-size: 14px; padding-top: -10px; padding-bottom: -10px')
					p.innerHTML = item.content;

					var a = document.createElement('a');
					a.setAttribute('name', i);
					//a3.setAttribute('id','test')
					a.setAttribute('onclick', 'show_detail(this.name)');
					a.innerHTML = 'Learn more';
					var li_detail = document.createElement('li');
					li_detail.setAttribute('class', 'cart');
					li_detail.appendChild(a);
					var ul_buttons = document.createElement('ul');
					ul_buttons.setAttribute('class', 'cart__action d-flex');
					ul_buttons.appendChild(li_detail);

					div_con.appendChild(h1);
					div_con.appendChild(h2);
					div_con.appendChild(p);
					div_con.appendChild(ul_buttons);

					div_col.appendChild(div_con);
					divFrame.appendChild(div_col);
					listView.appendChild(divFrame);
				}
				
			}

			function showAnns(active_page) {
				Cookies.remove('now_index');
				var temp_len = pageBar.childNodes.length;
				for (var i = 0; i < temp_len; i++) {
					pageBar.removeChild(pageBar.childNodes[0]);
				}
				if (annList != null && annList.length > 0) {
					pageNum = parseInt(annList.length / page_scale);
					lastPageBookNum = annList.length - pageNum * page_scale;
					if (lastPageBookNum != 0) pageNum = pageNum + 1;
					for (var i = 0; i < pageNum; i++) {
						var a_item = document.createElement('a');
						a_item.innerHTML = i + 1;
						a_item.setAttribute('id', i);
						a_item.setAttribute('onclick', 'showPage(this.id)');
						var li_item = document.createElement('li');
						li_item.appendChild(a_item);
						pageBar.appendChild(li_item);
					}
					var end_i_item = document.createElement('i');
					end_i_item.setAttribute('class', 'zmdi zmdi-chevron-right');
					var end_a_item = document.createElement('a');
					end_a_item.appendChild(end_i_item);
					var end_li_item = document.createElement('li');
					end_li_item.appendChild(end_a_item);
					pageBar.appendChild(end_li_item);
					//window.alert(active_page);
					showPage(active_page);
				} else if (annList == null) {
					//window.alert(111);
					temp_len = listView.childNodes.length;

					for (var i = 0; i < temp_len; i++) {
						listView.removeChild(listView.childNodes[0]);
					}
				} else {
					temp_len = listView.childNodes.length;
					for (var i = 0; i < temp_len; i++) {
						listView.removeChild(listView.childNodes[0]);
					}

				}
			}

			socket.emit('getAllAnnouncement');

			socket.on('show_announcement', function (data) {
				annList = data;
				showAnns(0);
			});

			function show_detail(index) {
				var item = annList[index];
				
				Cookies.set('cur_ann', item.title, {expires: 1});
				window.open('single-announcement.html');
			}

			function noLogin() {
				topMenu.innerHTML = 'My account';
				accLog.innerHTML = 'Log in';
				logFlag = false;

				if (accMenu != null) {
					var parent = accMenu.parentNode;
					parent.removeChild(parent.childNodes[0]);
					parent = parent.parentNode;
					parent.removeChild(parent.childNodes[0]);
				}
			}

			function personConsole() {
				socket.emit('sessionAuth', auth_data);
				if (logFlag == false) return;	//如果检查发现登陆失效，跳转失败退出
				location.href = location.href.replace('announcement.html', 'profile.html');
			}

			function signinServer() {
				if (logFlag == false) {
					location.href = location.href.replace('announcement.html', 'login.html');
				} else {
					socket.emit('logOut', auth_data);
					noLogin();
				}
			}

			socket.on("noSession", function (data) {
				Cookies.remove('type');
				window.alert('Login has expired, please login again!');
				noLogin();
			});

			socket.on('sessionSuccess', function (data) {
				topMenu.innerHTML = auth_data.username;
				accMenu.innerHTML = 'Profile';
				accLog.innerHTML = 'Logout';
				logFlag = true;
			});

			socket.on("sessionFailed", function (data) {
				Cookies.remove('type');
				window.alert('Login has expired, please login again!');
				noLogin();
			});

			if (auth_data.type == "reader") {
				socket.emit("sessionAuth", auth_data);
			} else {
				noLogin();
			}
		
	</script>
	</body>
	</html>
